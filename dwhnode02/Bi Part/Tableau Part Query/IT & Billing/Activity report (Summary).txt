SELECT CUSTOMER_NO,CUSTOMER_NAME,DEALER_MOB_NO,RETAILER_NO,RETAILER_NAME,RETAILER_MOB_NO,PRODUCT_NAME,COUNT(MSISDN) MSISDN_COUNT
FROM 
(SELECT CUSTOMER_NO,CUSTOMER_NAME,DEALER_MOB_NO,RETAILER_NO,RETAILER_NAME,RETAILER_MOB_NO,PRODUCT_NAME,MSISDN FROM 
(
SELECT * FROM 
(SELECT D.CUSTOMER_NO, D.CUSTOMER_NAME,R.RETAILER_NO, R.RETAILER_NAME,T.DEALER_MOB_NO,T.RETAILER_MOB_NO,T.ITEM_MOB_NO
FROM
(SELECT /*+PARALLEL(I,15)*/ RETAILER_NO,CUSTOMER_NO,A.DEALER_MOB_NO,A.RETAILER_MOB_NO,A.ITEM_MOB_NO
FROM SYNM_DMS_ITEMISSUEDTL@DWH05TODMS I
LEFT OUTER JOIN SYNM_DMS_ACTIVATION@DWH05TODMS A
ON ( I.ISS_2_RETAILER_NO = A.RETAILER_NO
AND I.ERP_ITEM_NO = A.ERP_ITEM_NO
AND I.ITEM_MOB_NO=A.ITEM_MOB_NO
)
WHERE I.ERP_ITEM_NO = 15186 AND I.ISS_2_RETAILER_NO IS NOT NULL
)T
JOIN SYNM_DMS_RETAILER_INFO@DWH05TODMS R ON (T.RETAILER_NO = R.RETAILER_NO)
JOIN SYNM_DMS_DEALER_INFO@DWH05TODMS D ON (T.CUSTOMER_NO = D.CUSTOMER_NO)
)E
RIGHT OUTER JOIN
(SELECT MSISDN,LU_PRODUCT_KEY,LR_PRODUCT_KEY

 FROM 
(
SELECT /*+PARALLEL(P,15)*/ MSISDN,LU_PRODUCT_KEY,LR_PRODUCT_KEY
        
FROM LAST_ACTIVITY_FCT_LD P
WHERE LU_DATE_KEY <(SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE = TO_DATE(SYSDATE-7,'DD/MM/RRRR'))
AND LU_DATE_KEY >=(SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE = TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
)A

)F
ON  CONCAT('880',ITEM_MOB_NO)=MSISDN
)P
LEFT OUTER JOIN
PRODUCT_DIM Q ON (LU_PRODUCT_KEY=Q.PRODUCT_ID OR (LR_PRODUCT_KEY=Q.PRODUCT_ID AND P.LU_PRODUCT_KEY=0))

)
GROUP BY CUSTOMER_NO,CUSTOMER_NAME,DEALER_MOB_NO,RETAILER_NO,RETAILER_NAME,RETAILER_MOB_NO,PRODUCT_NAME