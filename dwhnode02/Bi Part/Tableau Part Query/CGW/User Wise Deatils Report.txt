SELECT DATE_VALUE,CGW5_USERNAME,NVL(SUCCESSFUL_COUNT,0)SUCCESSFUL_COUNT,NVL(SUCCESSFUL_AMOUNT,0)SUCCESSFUL_AMOUNT,NVL(FAILED_COUNT,0)FAILED_COUNT,
       NVL(FAILEDL_AMOUNT,0)FAILEDL_AMOUNT,NVL(FAILED_COUNT_PER,0)FAILED_COUNT_PER,NVL(FAILED_AMOUNT_PER,0)FAILED_AMOUNT_PER
FROM
(SELECT DATE_VALUE,CGW5_USERNAME,SUCCESSFUL_COUNT,SUCCESSFUL_AMOUNT,FAILED_COUNT, FAILEDL_AMOUNT,
         ( FAILED_COUNT/TOTAL_FAILED_COUNT )*100 FAILED_COUNT_PER,
        (FAILEDL_AMOUNT/TOTAL_FAILEDL_AMOUNT)*100 FAILED_AMOUNT_PER
FROM
(SELECT /*+PARALLEL(P,15)*/ CGW15_TRANSACTION_TIME_KEY,CGW5_USERNAME ,
COUNT(
CASE 
WHEN  CGW10_RESULT_CODE =0
THEN 1
END
) SUCCESSFUL_COUNT,
SUM(
CASE 
WHEN  CGW10_RESULT_CODE =0
THEN CGW14_AMOUNT
END
) SUCCESSFUL_AMOUNT,
COUNT(
CASE 
WHEN  CGW10_RESULT_CODE !=0
THEN 1
END
)  FAILED_COUNT,
SUM(
CASE 
WHEN  CGW10_RESULT_CODE !=0
THEN CGW14_AMOUNT
END
) FAILEDL_AMOUNT
FROM  L3_CGW P
WHERE CGW15_TRANSACTION_TIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-7,'DD/MM/RRRR'))
GROUP BY  CGW15_TRANSACTION_TIME_KEY,CGW5_USERNAME
) A ,

(SELECT /*+PARALLEL(P,15)*/ CGW15_TRANSACTION_TIME_KEY,
COUNT(
CASE 
WHEN  CGW10_RESULT_CODE !=0
THEN 1
END
)  TOTAL_FAILED_COUNT,
SUM(
CASE 
WHEN  CGW10_RESULT_CODE !=0
THEN CGW14_AMOUNT
END
) TOTAL_FAILEDL_AMOUNT

FROM  L3_CGW P
WHERE CGW15_TRANSACTION_TIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-7,'DD/MM/RRRR'))
group by CGW15_TRANSACTION_TIME_KEY
)B ,DATE_DIM C
WHERE A.CGW15_TRANSACTION_TIME_KEY=B.CGW15_TRANSACTION_TIME_KEY AND A.CGW15_TRANSACTION_TIME_KEY=C.DATE_KEY
)