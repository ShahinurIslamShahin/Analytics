SELECT R385_OFFERINGID OFFERING_ID,OFFERING_NAME,R377_CYCLEBEGINTIME_KEY DATE_KEY,DATE_VALUE,UNIQUE_SUBSCRIBERS_COUNT,SUBSCRIPTION_COUNT,COMBO_OFFER_REVENUE,
       PER_PERSON_REVENUE,RECHARGE_AMOUNT
FROM OFFER_DIM G,DATE_DIM H,
(SELECT P.R385_OFFERINGID,P.R377_CYCLEBEGINTIME_KEY,UNIQUE_SUBSCRIBERS_COUNT,SUBSCRIPTION_COUNT,COMBO_OFFER_REVENUE,PER_PERSON_REVENUE,RECHARGE_AMOUNT
FROM 
(SELECT /*+PARALLEL(P,15)*/  R385_OFFERINGID,R377_CYCLEBEGINTIME_KEY,COUNT(DISTINCT R375_CHARGINGPARTYNUMBER)UNIQUE_SUBSCRIBERS_COUNT, 
                              COUNT(R375_CHARGINGPARTYNUMBER) SUBSCRIPTION_COUNT  ,SUM(R41_DEBIT_AMOUNT)COMBO_OFFER_REVENUE,
                              SUM(R41_DEBIT_AMOUNT)/COUNT( DISTINCT R375_CHARGINGPARTYNUMBER) PER_PERSON_REVENUE
FROM  DWH_USER.L3_RECURRING  P
WHERE  (R377_CYCLEBEGINTIME_KEY BETWEEN (SELECT DATE_KEY FROM DWH_USER.DATE_DIM  WHERE DATE_VALUE = TO_DATE('10/01/2021','DD/MM/RRRR'))
                                                       AND  (SELECT DATE_KEY FROM DWH_USER.DATE_DIM  WHERE DATE_VALUE = TO_DATE('10/02/2021','DD/MM/RRRR')))
       AND R385_OFFERINGID IN ( SELECT OFFERING_ID FROM DWH_USER.OFFER_DIM WHERE OFFER_TYPE='Combo')
GROUP BY R385_OFFERINGID,R377_CYCLEBEGINTIME_KEY
)P


LEFT OUTER JOIN


(SELECT R385_OFFERINGID,R377_CYCLEBEGINTIME_KEY, SUM(RECHARGE_AMOUNT)RECHARGE_AMOUNT
FROM
(SELECT R385_OFFERINGID,R377_CYCLEBEGINTIME_KEY,R375_CHARGINGPARTYNUMBER,RECHARGE_AMOUNT
FROM 
(SELECT /*+PARALLEL(P,15)*/ DISTINCT  R385_OFFERINGID,R377_CYCLEBEGINTIME_KEY, R375_CHARGINGPARTYNUMBER
FROM  DWH_USER.L3_RECURRING  P
WHERE  (R377_CYCLEBEGINTIME_KEY BETWEEN (SELECT DATE_KEY FROM DWH_USER.DATE_DIM  WHERE DATE_VALUE = TO_DATE('10/01/2021','DD/MM/RRRR'))
                                                       AND  (SELECT DATE_KEY FROM DWH_USER.DATE_DIM  WHERE DATE_VALUE = TO_DATE('10/02/2021','DD/MM/RRRR')))
       AND R385_OFFERINGID IN ( SELECT OFFERING_ID FROM DWH_USER.OFFER_DIM WHERE OFFER_TYPE='Combo')
)A
LEFT OUTER JOIN
(

SELECT /*+PARALLEL(P,15)*/ RE30_ENTRY_DATE_KEY ,RE6_PRI_IDENTITY, SUM(RE3_RECHARGE_AMT) RECHARGE_AMOUNT 
FROM L3_RECHARGE P
WHERE  (RE30_ENTRY_DATE_KEY BETWEEN (SELECT DATE_KEY FROM DWH_USER.DATE_DIM  WHERE DATE_VALUE = TO_DATE('10/01/2021','DD/MM/RRRR'))
                                                       AND  (SELECT DATE_KEY FROM DWH_USER.DATE_DIM  WHERE DATE_VALUE = TO_DATE('10/02/2021','DD/MM/RRRR')))
GROUP BY RE30_ENTRY_DATE_KEY,RE6_PRI_IDENTITY
ORDER BY RE30_ENTRY_DATE_KEY

)B ON R377_CYCLEBEGINTIME_KEY=RE30_ENTRY_DATE_KEY AND R375_CHARGINGPARTYNUMBER=RE6_PRI_IDENTITY
)
GROUP BY R385_OFFERINGID,R377_CYCLEBEGINTIME_KEY
)Q ON P.R385_OFFERINGID=Q.R385_OFFERINGID AND P.R377_CYCLEBEGINTIME_KEY=Q.R377_CYCLEBEGINTIME_KEY
)
I
WHERE I.R385_OFFERINGID=G.OFFERING_ID  AND I.R377_CYCLEBEGINTIME_KEY=H.DATE_KEY
ORDER BY R377_CYCLEBEGINTIME_KEY