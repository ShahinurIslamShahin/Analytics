SELECT MSISDN, R.PRODUCT_ID,PRODUCT_NAME,DATE_VALUE, LAST_ACTIVITY_DATE, VOICE_PAYG_REVENUE, VOICE_RECURRING_REVENUE, VOICE_REVENUE, MO_DURATION_MINS, MT_DURATION_MINS, MO_CALL_COUNT,
       MT_CALL_COUNT, DATA_PAYG_REVENUE, DATA_BUNDLE_REVENUE, DATA_REVENUE, DATA_USAGE_MB, SMS_PAYG_REVENUE, SMS_BUNDLE_REVENUE, SMS_REVENUE,
       MO_SMS_COUNT, MT_SMS_COUNT, COMBO_BUNDLE_REVENUE, RECHARGE_AMOUNT
FROM PRODUCT_DIM P, DATE_DIM Q,
(SELECT A.MSISDN, PRODUCT_ID, DATE_KEY,B.DATE_VALUE LAST_ACTIVITY_DATE, VOICE_PAYG_REVENUE, VOICE_RECURRING_REVENUE, VOICE_REVENUE, MO_DURATION_MINS, MT_DURATION_MINS, MO_CALL_COUNT,
       MT_CALL_COUNT, DATA_PAYG_REVENUE, DATA_BUNDLE_REVENUE, DATA_REVENUE, DATA_USAGE_MB, SMS_PAYG_REVENUE, SMS_BUNDLE_REVENUE, SMS_REVENUE,
       MO_SMS_COUNT, MT_SMS_COUNT, COMBO_BUNDLE_REVENUE, RECHARGE_AMOUNT
       FROM
(SELECT /*+PARALLEL(Q,15)*/ *
FROM SUBSCRIBER_USAGE_ANALYSIS Q
WHERE EXISTS
(SELECT /*+PARALLEL(P,15)*/ *
FROM
(SELECT /*+PARALLEL(P,15)*/ MSISDN, LU_DATE_KEY FROM LAST_ACTIVITY_FCT_LD P
WHERE MSISDN IN (SELECT /*+PARALLEL(P,15)*/ * FROM SHOTOBORSHO_B2W_NEW P)
ORDER BY LU_DATE_KEY
)P
WHERE Q.MSISDN=P.MSISDN AND (Q.DATE_KEY BETWEEN TO_CHAR(TO_NUMBER(P.LU_DATE_KEY)-7) AND P.LU_DATE_KEY)
)
)A


LEFT OUTER JOIN


(SELECT /*+PARALLEL(P,15)*/ MSISDN, DATE_VALUE FROM LAST_ACTIVITY_FCT_LD P,DATE_DIM Q
WHERE MSISDN IN (SELECT /*+PARALLEL(P,15)*/ * FROM SHOTOBORSHO_B2W_NEW P)
AND P.LU_DATE_KEY=Q.DATE_KEY
)B ON A.MSISDN=B.MSISDN
)R
WHERE P.PRODUCT_ID=R.PRODUCT_ID AND Q.DATE_KEY=R.DATE_KEY
ORDER BY MSISDN