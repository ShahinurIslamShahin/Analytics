SELECT/*+PARALLEL(B,15)*/  MSISDN ,PRODUCT_NAME, DATE_VALUE,VOICE_REVENUE,DATA_REVENUE,RECHARGE_AMOUNT FROM PRODUCT_DIM A,DATE_DIM C,
(SELECT P.V372_CALLINGPARTYNUMBER MSISDN,P.V397_MAINOFFERINGID,P.V387_CHARGINGTIME_KEY,COALESCE (VOICE_PAYG_REVENUE, 0)+COALESCE (VOICE_RECURRING_REVENUE, 0) VOICE_REVENUE,
       COALESCE (DATA_PAYG_REVENUE, 0)+COALESCE (DATA_BUNDLE_REVENUE, 0) DATA_REVENUE,COALESCE (RECHARGE_AMOUNT, 0)RECHARGE_AMOUNT
FROM 
((SELECT  /*+PARALLEL(P,15)*/ V372_CALLINGPARTYNUMBER,V397_MAINOFFERINGID,V387_CHARGINGTIME_KEY
FROM L3_VOICE P
WHERE V387_CHARGINGTIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
AND V378_SERVICEFLOW=1                                                   
GROUP BY V372_CALLINGPARTYNUMBER,V397_MAINOFFERINGID,V387_CHARGINGTIME_KEY
)

UNION

(SELECT  /*+PARALLEL(P,15)*/ R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY
FROM L3_RECURRING P
WHERE R377_CYCLEBEGINTIME_KEY IN  (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                         
      AND R385_OFFERINGID IN ( SELECT OFFERING_ID FROM OFFER_DIM WHERE OFFER_TYPE='Voice')
GROUP BY R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY
)

UNION

(SELECT  /*+PARALLEL(P,8)*/ G372_CALLINGPARTYNUMBER,G401_MAINOFFERINGID,G383_CHARGINGTIME_KEY
FROM L3_DATA P
WHERE G383_CHARGINGTIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                                      

GROUP BY G372_CALLINGPARTYNUMBER,G401_MAINOFFERINGID,G383_CHARGINGTIME_KEY
)

UNION

(SELECT  /*+PARALLEL(P,8)*/ R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY
FROM L3_RECURRING P
WHERE R377_CYCLEBEGINTIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                              
      AND R385_OFFERINGID IN ( SELECT OFFERING_ID FROM OFFER_DIM WHERE OFFER_TYPE='Data')
GROUP BY R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY
)

UNION

(SELECT  /*+PARALLEL(P,15)*/ RE6_PRI_IDENTITY,RE489_MAINOFFERINGID,RE30_ENTRY_DATE_KEY
FROM L3_RECHARGE P
WHERE RE30_ENTRY_DATE_KEY IN  (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                                       

GROUP BY RE6_PRI_IDENTITY,RE489_MAINOFFERINGID,RE30_ENTRY_DATE_KEY
)
)P

LEFT OUTER JOIN

(SELECT  /*+PARALLEL(P,15)*/ V372_CALLINGPARTYNUMBER,V397_MAINOFFERINGID,V387_CHARGINGTIME_KEY, SUM(V41_DEBIT_AMOUNT) VOICE_PAYG_REVENUE 
FROM L3_VOICE P
WHERE V387_CHARGINGTIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                                      

GROUP BY V372_CALLINGPARTYNUMBER,V397_MAINOFFERINGID,V387_CHARGINGTIME_KEY
)Q ON P.V372_CALLINGPARTYNUMBER=Q.V372_CALLINGPARTYNUMBER AND  P.V397_MAINOFFERINGID=Q.V397_MAINOFFERINGID AND P.V387_CHARGINGTIME_KEY=Q.V387_CHARGINGTIME_KEY

LEFT OUTER JOIN

(SELECT  /*+PARALLEL(P,15)*/ R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY,SUM(R41_DEBIT_AMOUNT) VOICE_RECURRING_REVENUE 
FROM L3_RECURRING P
WHERE R377_CYCLEBEGINTIME_KEY IN  (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                         
      AND R385_OFFERINGID IN ( SELECT OFFERING_ID FROM OFFER_DIM WHERE OFFER_TYPE='Voice')
GROUP BY R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY
)R ON P.V372_CALLINGPARTYNUMBER=R.R375_CHARGINGPARTYNUMBER AND  P.V397_MAINOFFERINGID=R.R373_MAINOFFERINGID AND P.V387_CHARGINGTIME_KEY=R.R377_CYCLEBEGINTIME_KEY

LEFT OUTER JOIN

(SELECT  /*+PARALLEL(P,8)*/ G372_CALLINGPARTYNUMBER,G401_MAINOFFERINGID,G383_CHARGINGTIME_KEY, SUM(G41_DEBIT_AMOUNT) DATA_PAYG_REVENUE 
FROM L3_DATA P
WHERE G383_CHARGINGTIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                                      

GROUP BY G372_CALLINGPARTYNUMBER,G401_MAINOFFERINGID,G383_CHARGINGTIME_KEY
)S ON P.V372_CALLINGPARTYNUMBER=S.G372_CALLINGPARTYNUMBER AND  P.V397_MAINOFFERINGID=S.G401_MAINOFFERINGID AND P.V387_CHARGINGTIME_KEY=S.G383_CHARGINGTIME_KEY

LEFT OUTER JOIN

(SELECT  /*+PARALLEL(P,8)*/ R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY,SUM(R41_DEBIT_AMOUNT) DATA_BUNDLE_REVENUE FROM L3_RECURRING P
WHERE R377_CYCLEBEGINTIME_KEY IN (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                              
      AND R385_OFFERINGID IN ( SELECT OFFERING_ID FROM OFFER_DIM WHERE OFFER_TYPE='Data')
GROUP BY R375_CHARGINGPARTYNUMBER,R373_MAINOFFERINGID,R377_CYCLEBEGINTIME_KEY
)T ON P.V372_CALLINGPARTYNUMBER=T.R375_CHARGINGPARTYNUMBER AND  P.V397_MAINOFFERINGID=T.R373_MAINOFFERINGID AND P.V387_CHARGINGTIME_KEY=T.R377_CYCLEBEGINTIME_KEY

LEFT OUTER JOIN

(SELECT  /*+PARALLEL(P,15)*/ RE6_PRI_IDENTITY,RE489_MAINOFFERINGID,RE30_ENTRY_DATE_KEY,SUM(RE3_RECHARGE_AMT) RECHARGE_AMOUNT FROM L3_RECHARGE P
WHERE RE30_ENTRY_DATE_KEY IN  (SELECT DATE_KEY FROM DATE_DIM  WHERE DATE_VALUE >= TO_DATE(SYSDATE-30,'DD/MM/RRRR'))
                                                       

GROUP BY RE6_PRI_IDENTITY,RE489_MAINOFFERINGID,RE30_ENTRY_DATE_KEY
)U ON P.V372_CALLINGPARTYNUMBER=U.RE6_PRI_IDENTITY AND  P.V397_MAINOFFERINGID=U.RE489_MAINOFFERINGID AND P.V387_CHARGINGTIME_KEY=U.RE30_ENTRY_DATE_KEY
)B
WHERE V397_MAINOFFERINGID=PRODUCT_ID AND V387_CHARGINGTIME_KEY=DATE_KEY
