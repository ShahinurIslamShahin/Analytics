SELECT A.LFTPOINT_NAME,TOTAL_ACTIVE_RETAILER,TOTAL_SIM_SALE_RETAILER,TOTAL_ONLY_TC_RETAILER,ZERO_BALANCE_RETAILER
 FROM 
(SELECT LFTPOINT_NAME, COUNT(*)
 TOTAL_ACTIVE_RETAILER FROM 
(SELECT RETAILER_NO,TELECHARGE_NO,DEALER_NO,
       CUSTOMER_NO ,DIST_LIFTING_POINT ,
       CASE 
       WHEN LFTPOINT_NAME  IS NOT NULL
       THEN LFTPOINT_NAME
       WHEN LFTPOINT_NAME  IS  NULL
       THEN 'Common Lifting point'
       END LFTPOINT_NAME
       FROM 
(SELECT /*+PARALLEL(P,15)*/unique RETAILER_NO,TELECHARGE_NO,DEALER_NO 
FROM TTALK_DMS.S_BI_ACC_DM_RETAILER_INFO_V@DWH05TO_DMS P)A
left outer join 
(SELECT /*+PARALLEL(P,15)*/unique CUSTOMER_NO ,DIST_LIFTING_POINT ,LFTPOINT_NAME
FROM TTALK_DMS.S_BI_ACC_DM_DEALER_INFO_V@DWH05TO_DMS P, TTALK_DMS.S_BI_ACC_DM_LIFTINGPOINT_V@DWH05TO_DMS Q
WHERE DIST_LIFTING_POINT= LFTPOINT_NO)B ON A.DEALER_NO=B.CUSTOMER_NO)
GROUP BY LFTPOINT_NAME
ORDER BY LFTPOINT_NAME
)A

LEFT OUTER JOIN


(SELECT LFTPOINT_NAME,COUNT(TELECHARGE_NO)TOTAL_SIM_SALE_RETAILER  FROM 
(SELECT RETAILER_NO,CONCAT('880',TELECHARGE_NO)TELECHARGE_NO,DEALER_NO,
       CUSTOMER_NO ,DIST_LIFTING_POINT ,
       CASE 
       WHEN LFTPOINT_NAME  IS NOT NULL
       THEN LFTPOINT_NAME
       WHEN LFTPOINT_NAME  IS  NULL
       THEN 'Common Lifting point'
       END LFTPOINT_NAME
       FROM 
(SELECT /*+PARALLEL(P,15)*/UNIQUE RETAILER_NO,TELECHARGE_NO,DEALER_NO 
FROM TTALK_DMS.S_BI_ACC_DM_RETAILER_INFO_V@DWH05TO_DMS P)A
LEFT OUTER JOIN 
(SELECT /*+PARALLEL(P,15)*/UNIQUE CUSTOMER_NO ,DIST_LIFTING_POINT ,LFTPOINT_NAME
FROM TTALK_DMS.S_BI_ACC_DM_DEALER_INFO_V@DWH05TO_DMS P, TTALK_DMS.S_BI_ACC_DM_LIFTINGPOINT_V@DWH05TO_DMS Q
WHERE DIST_LIFTING_POINT= LFTPOINT_NO)B ON A.DEALER_NO=B.CUSTOMER_NO) C
WHERE TELECHARGE_NO IN
(SELECT /*+PARALLEL(P,15)*/SAF_RETAILERMOBILE
FROM BI_SAF@DWH05TOETSAF P
WHERE SAF_VERIFIED=4
AND SAF_REG_TYPE_DESC IN ('NEW_PREPAID','PREPAID_CAMPAIGN','NEW_POSTPAID')
AND TO_DATE(SUBSTR(SAF_ENTRYDATE,1,9)) BETWEEN TO_DATE(SYSDATE-30,'DD/MM/RRRR') AND TO_DATE(SYSDATE-1,'DD/MM/RRRR')
GROUP BY SAF_RETAILERMOBILE
)
GROUP BY LFTPOINT_NAME
ORDER BY LFTPOINT_NAME
)B ON A.LFTPOINT_NAME=B.LFTPOINT_NAME

LEFT OUTER JOIN


(SELECT LFTPOINT_NAME,COUNT(TELECHARGE_NO)TOTAL_ONLY_TC_RETAILER  FROM 
(SELECT RETAILER_NO,CONCAT('880',TELECHARGE_NO)TELECHARGE_NO,DEALER_NO,
       CUSTOMER_NO ,DIST_LIFTING_POINT ,
       CASE 
       WHEN LFTPOINT_NAME  IS NOT NULL
       THEN LFTPOINT_NAME
       WHEN LFTPOINT_NAME  IS  NULL
       THEN 'Common Lifting point'
       END LFTPOINT_NAME
       FROM 
(SELECT /*+PARALLEL(P,15)*/UNIQUE RETAILER_NO,TELECHARGE_NO,DEALER_NO 
FROM TTALK_DMS.S_BI_ACC_DM_RETAILER_INFO_V@DWH05TO_DMS P)A
LEFT OUTER JOIN 
(SELECT /*+PARALLEL(P,15)*/UNIQUE CUSTOMER_NO ,DIST_LIFTING_POINT ,LFTPOINT_NAME
FROM TTALK_DMS.S_BI_ACC_DM_DEALER_INFO_V@DWH05TO_DMS P, TTALK_DMS.S_BI_ACC_DM_LIFTINGPOINT_V@DWH05TO_DMS Q
WHERE DIST_LIFTING_POINT= LFTPOINT_NO)B ON A.DEALER_NO=B.CUSTOMER_NO) C
WHERE TELECHARGE_NO IN
(SELECT /*+PARALLEL(P,15)*/ UNIQUE ER03_MSISDN_DEALER 
FROM L3_EVCREC P
WHERE ER12_RECHARGE_DATE_KEY BETWEEN  (SELECT DATE_KEY FROM DATE_DIM WHERE DATE_VALUE = TRUNC(TO_DATE(SYSDATE-30,'DD/MM/RRRR')))
                             AND (SELECT DATE_KEY FROM DATE_DIM WHERE DATE_VALUE = TRUNC(TO_DATE(SYSDATE-2,'DD/MM/RRRR')))
AND ER15_TRANSACTION_STATUS=0
)
GROUP BY LFTPOINT_NAME
ORDER BY LFTPOINT_NAME

)C ON A.LFTPOINT_NAME=C.LFTPOINT_NAME

LEFT OUTER JOIN


(SELECT LFTPOINT_NAME,COUNT(TELECHARGE_NO)ZERO_BALANCE_RETAILER  FROM 
(SELECT RETAILER_NO,CONCAT('880',TELECHARGE_NO)TELECHARGE_NO,DEALER_NO,
       CUSTOMER_NO ,DIST_LIFTING_POINT ,
       CASE 
       WHEN LFTPOINT_NAME  IS NOT NULL
       THEN LFTPOINT_NAME
       WHEN LFTPOINT_NAME  IS  NULL
       THEN 'Common Lifting point'
       END LFTPOINT_NAME
       FROM 
(SELECT /*+PARALLEL(P,15)*/UNIQUE RETAILER_NO,TELECHARGE_NO,DEALER_NO 
FROM TTALK_DMS.S_BI_ACC_DM_RETAILER_INFO_V@DWH05TO_DMS P)A
LEFT OUTER JOIN 
(SELECT /*+PARALLEL(P,15)*/UNIQUE CUSTOMER_NO ,DIST_LIFTING_POINT ,LFTPOINT_NAME
FROM TTALK_DMS.S_BI_ACC_DM_DEALER_INFO_V@DWH05TO_DMS P, TTALK_DMS.S_BI_ACC_DM_LIFTINGPOINT_V@DWH05TO_DMS Q
WHERE DIST_LIFTING_POINT= LFTPOINT_NO)B ON A.DEALER_NO=B.CUSTOMER_NO) C
WHERE TELECHARGE_NO NOT IN
(SELECT /*+PARALLEL(P,15)*/ UNIQUE ER03_MSISDN_DEALER 
FROM L3_EVCREC P
WHERE ER12_RECHARGE_DATE_KEY BETWEEN  (SELECT DATE_KEY FROM DATE_DIM WHERE DATE_VALUE = TRUNC(TO_DATE(SYSDATE-30,'DD/MM/RRRR')))
                             AND (SELECT DATE_KEY FROM DATE_DIM WHERE DATE_VALUE = TRUNC(TO_DATE(SYSDATE-2,'DD/MM/RRRR')))
AND ER15_TRANSACTION_STATUS=0
)
GROUP BY LFTPOINT_NAME
ORDER BY LFTPOINT_NAME

)D ON A.LFTPOINT_NAME=D.LFTPOINT_NAME